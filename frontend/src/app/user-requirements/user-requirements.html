<div class="min-vh-100 bg-light py-4 px-3">
  <div class="container-fluid">
    
    <div class="d-flex justify-content-between align-items-center mb-4">
      <div>
        <h4 class="fw-bold mb-0">User Requirements</h4>
        <small class="text-muted">Build requirements → generate enterprise quotation</small>
      </div>
      <div class="d-flex gap-2">
        <button class="btn btn-outline-primary btn-sm" routerLink="/pricing-master">← Pricing Master</button>
        <button class="btn btn-outline-danger btn-sm" (click)="onLogout()">Logout</button>
      </div>
    </div>

    <div class="row g-4">
      <div class="col-lg-5">
        <div class="card shadow-sm border-0 rounded-3">
          <div class="card-body p-4">
            <h5 class="fw-bold mb-4">Enter Requirements</h5>

            <form [formGroup]="form" (ngSubmit)="submit()">
              
              <div class="mb-4">
                <label class="form-label fw-semibold">No. of Cameras</label>
                <input type="number" class="form-control" placeholder="Enter camera count" formControlName="camera">
              </div>

              <div class="mb-4 position-relative">
                <label class="form-label fw-semibold">AI Features</label>
                
                <div class="form-control d-flex justify-content-between align-items-center cursor-pointer" 
                     (click)="toggleDropdown()" 
                     style="cursor: pointer; min-height: 45px;">
                  <span class="text-muted" *ngIf="selectedAIFeatures.length === 0">Select AI Features...</span>
                  <span *ngIf="selectedAIFeatures.length > 0">
                    {{ selectedAIFeatures.length }} Features Selected
                  </span>
                  <i class="bi" [ngClass]="showDropdown ? 'bi-chevron-up' : 'bi-chevron-down'"></i>
                </div>

                <div *ngIf="showDropdown" class="dropdown-container shadow-sm border rounded-2 mt-1 position-absolute w-100 bg-white" style="z-index: 1000; max-height: 250px; overflow-y: auto;">
                  <div *ngFor="let ai of aiFeatures" 
                       (click)="toggleFeature(ai)"
                       class="dropdown-item-custom p-2 d-flex justify-content-between align-items-center border-bottom"
                       [class.selected-item]="isSelected(ai)">
                    <span>{{ ai.AI_feature }} (₹{{ ai.costing }})</span>
                    <i class="bi bi-check-lg text-primary" *ngIf="isSelected(ai)"></i>
                  </div>
                </div>

                <div class="mt-2">
                  <p class="text-primary fw-bold mb-0">Total AI cost: ₹ {{ totalAICost }}</p>
                  <small class="text-muted">Click items to select/deselect multiple features.</small>
                </div>
              </div>

              <button type="submit" class="btn btn-primary btn-lg w-100 mt-2" [disabled]="loading || form.invalid">
                <i class="bi bi-file-earmark-plus me-2"></i>
                {{ loading ? 'Generating...' : 'Generate Quotation' }}
              </button>
            </form>
          </div>
        </div>
      </div>

      <div class="col-lg-7">
        <div class="card shadow-sm border-0 rounded-3 h-100">
          <div class="card-body p-4">
            <h5 class="fw-bold mb-3">Quotation Preview</h5>
            <hr>
            
            <div *ngIf="!quotation" class="text-center py-5 text-muted">
              <i class="bi bi-receipt h1 d-block mb-3 opacity-25"></i>
              No quotation generated yet.
            </div>

            <div *ngIf="quotation">
              <div class="p-3 bg-light rounded-3 mb-4">
                <h3 class="text-success fw-bold mb-0">Total: ₹ {{ quotation.total_costing }}</h3>
              </div>

              <div class="row mb-4">
                <div class="col-6">
                  <small class="text-muted d-block">Cameras</small>
                  <span class="fw-bold">{{ quotation.camera }}</span>
                </div>
              </div>

              <h6 class="fw-bold">Applied AI Features:</h6>
              <ul class="list-group list-group-flush">
                <li *ngFor="let ai of selectedAIFeatures" class="list-group-item d-flex justify-content-between px-0">
                  <span>{{ ai.AI_feature }}</span>
                  <span class="fw-semibold">₹{{ ai.costing }}</span>
                </li>
              </ul>
            </div>

          </div>
        </div>
      </div>

    </div>
  </div>
</div>